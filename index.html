<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Cabinet Invoice</title>
    <link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&family=Moul&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* General Setup */
        body { font-family: 'Battambang', sans-serif; background-color: #f0f0f0; margin: 0; padding: 20px; }
        .invoice-container { background-color: white; width: 210mm; min-height: 297mm; margin: 0 auto; padding: 40px; box-shadow: 0 0 10px rgba(0,0,0,0.1); position: relative; box-sizing: border-box;}
        
        /* Header Design */
        .header { 
            display: flex; 
            align-items: center; 
            margin-bottom: 20px; 
            border-bottom: 3px solid #1f506e; 
            padding-bottom: 15px;
        }
        
        /* LOGO UPLOAD AREA (NEW) */
        .logo-area { 
            width: 130px; 
            height: 130px; 
            margin-right: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ccc; /* áŠá¶á€áŸ‹á‚áŸ‚á˜áŠá¶á…áŸ‹áŸ—á¢áŸ„á™áŠá¹á„áá¶á…á»á…á”á¶á“ */
            cursor: pointer;
            background-color: #f9f9f9;
            overflow: hidden;
            position: relative;
        }
        .logo-area:hover { background-color: #eef; border-color: #1f506e; }
        .logo-area img { width: 100%; height: 100%; object-fit: contain; display: none; }
        .logo-placeholder-text { text-align: center; font-size: 11px; color: #888; pointer-events: none; }

        .company-title { flex-grow: 1; }
        .company-title h1 { 
            font-family: 'Moul', serif; 
            margin: 0; 
            font-size: 32px; 
            color: #1f506e; 
            text-transform: uppercase;
        }
        .sub-title { font-size: 16px; color: #e67e22; font-weight: bold; margin-top: 5px; }
        .invoice-details { text-align: right; font-size: 14px; color: #333; line-height: 1.5; }

        /* General Info */
        .info-section { display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 14px; }
        .customer-info { font-weight: bold; margin-bottom: 15px; font-size: 16px; border-bottom: 1px dotted #ccc; padding-bottom: 5px;}
        .description-box { margin-bottom: 20px; font-size: 14px; line-height: 1.6; }
        
        /* Blueprint Upload Area */
        .blueprint-placeholder { 
            width: 100%; height: 250px; 
            border: 2px dashed #1f506e; 
            margin: 10px 0; 
            display: flex; align-items: center; justify-content: center; 
            color: #aaa; position: relative; overflow: hidden; background-color: #fafafa;
        }
        .blueprint-placeholder img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        /* Table */
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; vertical-align: middle; }
        th { background-color: #1f506e; color: white; font-weight: bold; font-family: 'Battambang'; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .calc-input { width: 100%; border: none; text-align: center; font-family: 'Battambang'; outline: none; font-size: 14px;}
        .date-input { border: none; font-family: 'Battambang'; font-size: 14px; width: 120px; text-align: right; outline: none; font-weight: bold; cursor: pointer; }
        
        /* Footer */
        .payment-info { margin-top: 20px; font-size: 14px; background: #fdfdfd; padding: 15px; border-left: 5px solid #e67e22; }
        .signatures { display: flex; justify-content: space-between; margin-top: 60px; text-align: center; }
        .sign-line { width: 200px; border-top: 1px solid black; padding-top: 10px; font-weight: bold; }
        
        /* Buttons */
        .control-panel { position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 1000; }
        .btn { padding: 15px 25px; color: white; border: none; border-radius: 50px; cursor: pointer; font-family: 'Battambang'; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .print-btn { background-color: #1f506e; }
        .jpg-btn { background-color: #e67e22; }
        
        /* Hidden elements on Print/Save */
        .no-print-btn, .delete-btn { cursor: pointer; }
        .delete-btn { background-color: #dc3545; color: white; border: none; border-radius: 3px; padding: 2px 8px;}
        .no-print-btn { background-color: #28a745; color: white; border: none; padding: 5px 15px; border-radius: 4px; margin-top: 10px;}
        .upload-btn { position: absolute; top: 10px; right: 10px; padding: 5px 10px; background: #666; color: white; border: none; border-radius: 3px; cursor: pointer;}

        @media print {
            .control-panel, .no-print-btn, .delete-btn, .upload-btn { display: none !important; }
            .invoice-container { box-shadow: none; margin: 0; width: 100%; }
            body { background-color: white; padding: 0; }
            .logo-area { border: none; background: transparent; } /* á›á¶á€áŸ‹á‚áŸ‚á˜ Logo á–áŸá› Print */
            .logo-placeholder-text { display: none; }
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <button class="btn print-btn" onclick="window.print()">ğŸ–¨ï¸ Print</button>
        <button class="btn jpg-btn" onclick="saveAsJPG()">ğŸ’¾ Save JPG</button>
    </div>

    <div class="invoice-container" id="invoice-content">
        <div class="header">
            <div class="logo-area" onclick="document.getElementById('logo-upload').click()">
                <img id="logo-img" />
                <div class="logo-placeholder-text" id="logo-text">
                    ğŸ“· á…á»á…á‘á¸á“áŸáŸ‡<br>áŠá¾á˜áŸ’á”á¸áŠá¶á€áŸ‹ Logo
                </div>
                <input type="file" id="logo-upload" accept="image/*" style="display:none" onchange="loadLogo(event)">
            </div>
            
            <div class="company-title">
                <h1>Mobile Cabinet</h1>
                <div class="sub-title">áœá·á€áŸ’á€á™á”ááŸ’áš / INVOICE</div>
            </div>
            <div class="invoice-details" contenteditable="true">
                <b>Tel: 070 684 555</b><br>
                <b>060 241 555</b>
            </div>
        </div>

        <div class="info-section">
            <div contenteditable="true">
                á¢á¶áŸáŸá™áŠáŸ’á‹á¶á“áŸˆ áŠá¸á¡á¼ááŸá‚áŸ’á˜á¶á“á›áŸá, á—á¼á˜á·á€áŸ„á€ášáŸ’ášá·á…<br>
                áŸá„áŸ’á€á¶ááŸ‹áŸáŸ†ášáŸ„á„á€áŸ’ášáŸ„á˜, áááŸ’áŒá–áŸ„á’á·áŸáŸáŸ‚á“á‡áŸá™<br>
                ášá¶á‡á’á¶á“á¸á—áŸ’á“áŸ†á–áŸá‰
            </div>
            <div class="text-right">
                á€á¶á›á”ášá·á…áŸ’á†áŸá‘: <input type="text" id="date-input" class="date-input">
            </div>
        </div>

        <div class="customer-info" contenteditable="true">
            áˆáŸ’á˜áŸ„áŸ‡á¢áá·áá·á‡á“: CHANNIT <span style="margin-left:50px;">á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘: ...............................</span>
        </div>

        <div class="description-box" contenteditable="true">
            â—» á‡á‰áŸ’á‡á¶áŸ†á„áŸá¶áŸ†á„áŸáŸá„áŸ’á€áŸá¸á€áŸ’á”á¿á„áŸáŸ’ášá‘á¶á”áŸ‹áŸ¢á áŸŠá·á“ á‚áŸ’ášáŸ„á„áŠáŸ‚á€ 100x100 á”á¶ááŠáŸ‚á€ 40x80<br>
            á€áŸ’ášá¶á›á€áŸ’áŠá¶ášá€áŸ’á“á»á„á€áŸ’áá¶ášááŸ á€á˜áŸ’ášá¶áŸáŸ‹ 15á›á¸ [Free á€áŸ†ášá¶á›á€áŸ…áŸáŸŠá¼]<br>
            á€á¶ášášáŸ€á”á…áŸ†á˜á¶á“áŸˆ á‘áŸ’áœá¶ášáŠáŸ‚á€2/á”á„áŸ’á¢á½á…2 áœáŸ‚á„ 2m x 2m / á‡á¾á„á˜áŸ‰á¶áŸáŸŠá¸á“ááŸ’ášá‡á¶á€áŸ‹1<br>
            ğŸ“ á”áŸ’ášá–áŸá“áŸ’á’á—áŸ’á›á¾á„ áŒá¸áŸá„áŸ‹á‘áŸáš1 á€áŸ’á“á»á„áá¶á€2 á–áŸ’ášá¸á—áŸ’á›á¾á„2 á¢áŸ†á–á¼á›á—áŸ’á›á¾á„2 áŸ”<br>
            <b>áŸá˜áŸ’á‚á¶á›áŸ‹áŸˆ á‚áŸ’ášáŸ„á„á–ááŸŒ á”áŸ’ášá•áŸáŸ‡ / á€áŸ†ášá¶á›á€áŸ…áŸáŸŠá¼ á”áŸ’ášá•áŸáŸ‡ / áŸáŸ†á™á¶á”á›áŸ€á“ 0.1m/ á‡á¾á„á€áŸ’ášáŸ„á˜ 0.2m=6áŠá¾á˜..áŸ”</b>
        </div>

        <div class="blueprint-placeholder" id="blueprint-area">
            <span id="bp-text">áŠá¶á€áŸ‹ášá¼á”á—á¶á–á”áŸ’á›á„áŸ‹á‘á¸á“áŸáŸ‡ (Upload)</span>
            <img id="preview-img" style="display:none;" />
            <input type="file" id="file-upload" accept="image/*" style="display:none" onchange="loadFile(event)">
            <button class="upload-btn" onclick="document.getElementById('file-upload').click()">ğŸ“· Upload ášá¼á”</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width: 30%;">áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰</th>
                    <th style="width: 20%;">á‘áŸ†á áŸ†</th>
                    <th style="width: 10%;">á…áŸ†á“á½á“</th>
                    <th style="width: 15%;">áá˜áŸ’á›áŸƒášá¶á™ ($)</th>
                    <th style="width: 15%;">áá˜áŸ’á›áŸƒáŸášá»á” ($)</th>
                    <th style="width: 5%;" class="no-print-btn">á›á»á”</th>
                </tr>
            </thead>
            <tbody id="invoice-items">
                <tr>
                    <td><input type="text" class="calc-input text-left" value="á‘á¼ 1"></td>
                    <td><input type="text" class="calc-input" value="3m x 6m"></td>
                    <td><input type="number" class="calc-input qty" value="1" oninput="calculateTotal()"></td>
                    <td><input type="number" class="calc-input price" value="1650" oninput="calculateTotal()"></td>
                    <td class="total-cell">0.00</td>
                    <td class="no-print-btn"></td>
                </tr>
            </tbody>
        </table>
        <button class="no-print-btn" onclick="addRow()">â• á”á“áŸ’ááŸ‚á˜á‘áŸ†á“á·á‰</button>

        <div style="margin-top: 20px;">
            <table style="width: 40%; float: right; border: none;">
                <tr><td class="text-right" style="border:none"><b>áá˜áŸ’á›áŸƒáŸášá»á” (Total):</b></td><td class="total-cell" id="grand-total">0.00$</td></tr>
                <tr><td class="text-right" style="border:none">á”áŸ’ášá¶á€áŸ‹á€á€áŸ‹ (Deposit):</td><td style="border:none"><input type="number" class="calc-input" id="deposit-amt" value="500" oninput="calculateTotal()" style="border-bottom: 1px solid #ccc;"></td></tr>
                <tr><td class="text-right" style="border:none"><b>á”áŸ’ášá¶á€áŸ‹á“áŸ…áŸá›áŸ‹ (Balance):</b></td><td class="total-cell" id="balance-due" style="color: #e67e22; font-size: 20px;">0.00$</td></tr>
            </table>
            <div style="clear: both;"></div>
        </div>

        <div class="payment-info" contenteditable="true">
            <b>áŸá˜áŸ’á‚á¶á›áŸ‹áŸ–</b> áá˜áŸ’á›áŸƒáá¶á„á›á¾á˜á·á“á”á¼á€á€á¶ášá”á„áŸ‹á–á“áŸ’á’<br>
            áŸá¼á˜ááŸ’ášá½áá–á·á“á·ááŸ’á™á‘áŸ†á“á·á‰á˜á»á“á–áŸá›á…á»áŸ‡á ááŸ’áá›áŸáá¶áŸ”
        </div>

        <div class="signatures">
            <div><div class="sign-line" contenteditable="true">á ááŸ’áá›áŸáá¶á¢áŸ’á“á€á›á€áŸ‹</div></div>
            <div><div class="sign-line" contenteditable="true">á ááŸ’áá›áŸáá¶á¢áŸ’á“á€á‘á·á‰</div></div>
        </div>
    </div>

    <script>
        // á€á¶á›á”ášá·á…áŸ’á†áŸá‘
        const today = new Date();
        document.getElementById('date-input').value = today.toLocaleDateString('en-GB');

        // á˜á»áá„á¶ášá‚á·áá›á»á™
        function calculateTotal() {
            let rows = document.querySelectorAll('#invoice-items tr');
            let grandTotal = 0;
            rows.forEach(row => {
                let qty = parseFloat(row.querySelector('.qty').value) || 0;
                let price = parseFloat(row.querySelector('.price').value) || 0;
                let total = qty * price;
                row.querySelector('.total-cell').innerText = total.toFixed(2);
                grandTotal += total;
            });
            document.getElementById('grand-total').innerText = grandTotal.toFixed(2) + '$';
            let deposit = parseFloat(document.getElementById('deposit-amt').value) || 0;
            let balance = grandTotal - deposit;
            document.getElementById('balance-due').innerText = balance.toFixed(2) + '$';
        }

        // á”á“áŸ’ááŸ‚á˜/á›á»á”á‡á½áš
        function addRow() {
            let table = document.getElementById('invoice-items');
            let newRow = table.insertRow();
            newRow.innerHTML = `<td><input type="text" class="calc-input text-left" placeholder="áˆáŸ’á˜áŸ„áŸ‡"></td><td><input type="text" class="calc-input" placeholder="á‘áŸ†á áŸ†"></td><td><input type="number" class="calc-input qty" value="0" oninput="calculateTotal()"></td><td><input type="number" class="calc-input price" value="0" oninput="calculateTotal()"></td><td class="total-cell">0.00</td><td class="no-print-btn"><button class="delete-btn" onclick="removeRow(this)">âŒ</button></td>`;
        }
        function removeRow(btn) { btn.parentNode.parentNode.remove(); calculateTotal(); }

        // ============ á˜á»áá„á¶áš UPLOAD ááŸ’á˜á¸ ============
        
        // 1. áŸá˜áŸ’ášá¶á”áŸ‹ LOGO
        var loadLogo = function(event) {
            var image = document.getElementById('logo-img');
            image.src = URL.createObjectURL(event.target.files[0]);
            image.style.display = 'block';
            document.getElementById('logo-text').style.display = 'none'; // á›á¶á€áŸ‹á¢á€áŸ’áŸášá–áŸá›á˜á¶á“ášá¼á”
        };

        // 2. áŸá˜áŸ’ášá¶á”áŸ‹ á”áŸ’á›á„áŸ‹
        var loadFile = function(event) {
            var image = document.getElementById('preview-img');
            image.src = URL.createObjectURL(event.target.files[0]);
            image.style.display = 'block';
            document.getElementById('bp-text').style.display = 'none';
        };

        // SAVE JPG
        function saveAsJPG() {
            const element = document.getElementById("invoice-content");
            const btn = document.querySelector(".jpg-btn");
            btn.innerText = "â³ á€áŸ†á–á»á„ Save...";
            html2canvas(element, {
                scale: 2, useCORS: true, backgroundColor: "#ffffff",
                ignoreElements: (node) => { return node.classList.contains('no-print-btn') || node.classList.contains('upload-btn') || node.classList.contains('logo-placeholder-text'); }
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'MobileCabinet-' + Date.now() + '.jpg';
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                btn.innerText = "ğŸ’¾ Save JPG";
            });
        }
        calculateTotal();
    </script>
</body>
</html>